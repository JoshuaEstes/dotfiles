#!/usr/bin/env bash
# vi: set ft=sh :
set -e
source $DOTFILES_ROOT/lib/bash/functions.sh

####
#
# First figure out what box it is and run the main dependency managers
#
if [ $(uname) == "Linux" ]; then
    if [ $(command -v apt-get) ]; then
        log_info '>> sudo apt-get update'
        sudo apt-get update
        log_info '>> sudo apt-get upgrade'
        sudo apt-get upgrade
    fi
else
    if [ $(command -v brew) ]; then
        log_info '>> brew update'
        brew update
        log_debug 'Done'
        log_info '>> brew upgrade'
        brew upgrade
        log_debug 'Done'
        log_info '>> brew linkapps'
        brew linkapps
        log_debug 'Done'
        log_info '>> brew cleanup'
        brew cleanup
        log_debug 'Done'
        log_info '>> brew prune'
        brew prune
        log_debug 'Done'
    fi
fi

###
#
# Python Stuff
#
if [ $(command -v pip3) ]; then
    log_info "Upgrading pip"
    pip3 install --upgrade pip
    log_debug 'Done'
fi

####
#
# Vim
#
if [ $(command -v vim) ]; then
    log_info 'Updating Vundle bundles'
    vim +PluginUpdate +qall
    log_debug 'Done'
fi
#### end vim ####

####
#
# PHP
#
# composer
if [ $(command -v composer.phar) ]; then
    log_info 'Updating composer.phar'
    composer.phar selfupdate
    log_debug 'Done'

    log_info 'Updating composer global dependencies'
    composer.phar global update
    log_debug 'Done'
fi

# phpbrew
if [ $(command -v phpbrew) ]; then
    log_info '>> phpbrew self-update'
    phpbrew self-update
    log_debug 'Done'
fi

# Magento
if [ $(command -v n98-magerun.phar) ]; then
    log_info '>> n98-magerun.phar self-update'
    n98-magerun.phar self-update
    log_debug 'Done'
fi
#### end php ####

####
#
# Ruby
#
if [ $(command -v gem) ]; then
    log_debug '>> gem update --system'
    gem update --system
    log_debug 'Done'
    log_debug '>> gem update'
    gem update
    log_debug 'Done'
    log_debug '>> gem cleanup'
    gem cleanup
    log_debug 'Done'
fi
#### end ruby ####

####
#
# Node
#
if [ $(command -v npm) ]; then
    log_debug '>> npm install -g npm@latest'
    npm install -g npm@latest
    log_debug 'Done'
    log_debug '>> npm update -g'
    npm update -g
    log_debug 'Done'
fi
#### end node ####
